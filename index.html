<!DOCTYPE html>
<html>

<head>
  <title>Images to PDF Web App in Node and Express</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />
</head>

<body>
  <div class="container">
    <br><br>
    <h1 class="text-center">
      Convert Image to PDF
    </h1>
    <br>
    <form action="/merge" method="post" enctype="multipart/form-data">
      <div class="form-group">
        <input type="file" name="files" multiple required class="form-control" id="fileElem"
          accept="image/jpg, image/jpeg" onchange="handleFiles(this.files)">
      </div>
      <div id="gallery">
      </div>
      <div class="field">
        <label for="cowbell">Page Size</label>
        <select class="form-control" name="page_size">
          <option value="A4" selected>A4</option>
          <option value="A5">A5</option>
          <option value="A3">A3</option>
        </select>
      </div><!-- field -->
      <div class="field">
        <label>Select Size</label>
        <input type="range" name="range" id="range" min="10" max="100" step="10" value="90" />
        <label for="range">90</label>
        <label for="cowbell">Image Quality</label>
      </div>
      <div class="form-group">
        <button class="btn btn-danger btn-block">
          Convert to PDF
        </button>
      </div>
    </form>
  </div>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script>
  const range = document.getElementById("range");

  // https://stackoverflow.com/questions/10756313/javascript-jquery-map-a-range-of-numbers-to-another-range-of-numbers
  const scale = (num, in_min, in_max, out_min, out_max) => {
    return ((num - in_min) * (out_max - out_min)) / (in_max - in_min) + out_min;
  };

  range.addEventListener("input", (e) => {
    const value = +e.target.value;
    const label = e.target.nextElementSibling;
    const rangeWidth = getComputedStyle(e.target).getPropertyValue("width");
    const labelWidth = getComputedStyle(label).getPropertyValue("width");
    // remove px
    const numWidth = +rangeWidth.substring(0, rangeWidth.length - 2);
    const numLabelWidth = +labelWidth.substring(0, labelWidth.length - 2);
    const max = +e.target.max;
    const min = +e.target.min;
    const left =
      value * (numWidth / max) -
      numLabelWidth / 2 +
      scale(value, min, max, 10, -10);
    label.style.left = `${left}px`;
    label.innerHTML = value;
  });

  $("#fileElem").change(function () {
    var fileExtension = ['jpeg', 'jpg'];
    if ($.inArray($(this).val().split('.').pop().toLowerCase(), fileExtension) == -1) {
      alert("Only formats are allowed : " + fileExtension.join(', '));
    } else {
      $('.option-sidebar').show();
    }
  });

  function handleFiles(files) {
    var imgs = document.querySelectorAll('img');
    //Image element undex
    let imgIndex = 0;

    //Loop through all the images
    for (var i = 0; i < files.length; i++) {
      var reader = new FileReader();

      reader.onload = function (e) {
        $('<img src="' + e.target.result + '" id="imgg0" width="10%" class="imgg">').appendTo('#gallery');
        imgIndex++;
      }

      reader.readAsDataURL(files[i]);
    }
  }
</script>

</html>